{"ast":null,"code":"var _jsxFileName = \"/Users/me/Downloads/Projects/chatbot-lemonade/src/components/Chat/Chat.js\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport useSessionStorage from '../../utils/useSessionStorage';\nimport { calculateMathExpression, BOT_STEPS } from '../../utils/chatUtils';\nimport ChatHeader from '../ChatHeader/ChatHeader';\nimport ChatFooter from '../ChatFooter/ChatFooter';\nimport ChatContent from '../ChatContent/ChatContent';\nimport './Chat.css';\n\nconst Chat = () => {\n  const [name, setName] = useSessionStorage('name', '');\n  const [isBot, setIsBot] = useState(true);\n  const [messages, setMessages] = useState([]);\n  const messagesRef = useRef(messages);\n  messagesRef.current = messages; // useEffect(() => {\n  //   /*const stepDetails = getStepDetails(step, name, expression)\n  //  //   debugger\n  //   if (!stepDetails?.isUserInput) { \n  //       setTimeout(() => {\n  //         const nextStep = NEXT_STEP[step]\n  //     //    debugger\n  //           setStep(() => nextStep)\n  //           setIsPending(() => false)\n  //           setMessages([...messages, stepDetails])\n  //         }, 1000)\n  //     }*/\n  //   }, [messages])\n\n  useEffect(() => {\n    if (name) {\n      throttleMessages([...BOT_STEPS.NICE_TO_SEE(name), ...BOT_STEPS.DESCRIBE_PROCESS()]);\n    } else {\n      throttleMessages(BOT_STEPS.INTRO());\n    }\n\n    setIsBot(false);\n  }, []);\n\n  const throttleMessages = newMessages => {\n    newMessages.map(message => {\n      setTimeout(() => {\n        //debugger\n        setMessages(() => [...messagesRef.current, message]);\n      }, 2000);\n    });\n  };\n\n  const sendMessageHandler = newMessage => {\n    // We check if this is the user turn to give an input.\n    // If we already have a name, we expect math expression. Otherwise, we expect a name and add the correct messages.\n    if (!isBot) {\n      setIsBot(false);\n\n      if (!name) {\n        setName(newMessage);\n        throttleMessages([{\n          message: newMessage,\n          isUserInput: true\n        }, ...BOT_STEPS.NICE_TO_MEET(newMessage), ...BOT_STEPS.DESCRIBE_PROCESS()]);\n      } else {\n        throttleMessages([{\n          message: newMessage,\n          isUserInput: true\n        }, {\n          message: calculateMathExpression(newMessage)\n        }, ...BOT_STEPS.BOT_FEEDBACK()]);\n      }\n\n      return;\n    } // Add user messages to the list even if it is not the user turn\n\n\n    throttleMessages([{\n      message: newMessage,\n      isUserInput: true\n    }]);\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(ChatHeader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(ChatContent, {\n    messages: messages,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(ChatFooter, {\n    onSend: sendMessageHandler,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 9\n    }\n  }));\n};\n\nexport default Chat;","map":{"version":3,"sources":["/Users/me/Downloads/Projects/chatbot-lemonade/src/components/Chat/Chat.js"],"names":["React","useState","useEffect","useRef","useSessionStorage","calculateMathExpression","BOT_STEPS","ChatHeader","ChatFooter","ChatContent","Chat","name","setName","isBot","setIsBot","messages","setMessages","messagesRef","current","throttleMessages","NICE_TO_SEE","DESCRIBE_PROCESS","INTRO","newMessages","map","message","setTimeout","sendMessageHandler","newMessage","isUserInput","NICE_TO_MEET","BOT_FEEDBACK"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport useSessionStorage from '../../utils/useSessionStorage'\nimport { calculateMathExpression, BOT_STEPS } from '../../utils/chatUtils';\nimport ChatHeader from '../ChatHeader/ChatHeader'\nimport ChatFooter from '../ChatFooter/ChatFooter';\nimport ChatContent from '../ChatContent/ChatContent';\n\nimport './Chat.css';\n\n\n\nconst Chat = () => {\n    const [name, setName] = useSessionStorage('name', '')\n    const [isBot, setIsBot] = useState(true) \n    const [messages, setMessages] = useState([])\n\n    const messagesRef = useRef(messages);\n    messagesRef.current = messages;\n\n    // useEffect(() => {\n    //   /*const stepDetails = getStepDetails(step, name, expression)\n    //  //   debugger\n    //   if (!stepDetails?.isUserInput) { \n    //       setTimeout(() => {\n    //         const nextStep = NEXT_STEP[step]\n    //     //    debugger\n    //           setStep(() => nextStep)\n    //           setIsPending(() => false)\n    //           setMessages([...messages, stepDetails])\n    //         }, 1000)\n    //     }*/\n\n\n       \n    //   }, [messages])\n\n    useEffect(()=>{\n        if (name) {\n            throttleMessages([...BOT_STEPS.NICE_TO_SEE(name), ...BOT_STEPS.DESCRIBE_PROCESS()]) \n        }\n        else {\n            throttleMessages(BOT_STEPS.INTRO())\n        }\n\n        setIsBot(false)\n    }, [])\n\n\n\nconst throttleMessages = newMessages  => {\n    newMessages.map(message => {\n          \n        setTimeout(() => {\n           //debugger\n           setMessages(()=> [...messagesRef.current, message])\n          }, 2000)\n        })\n    }\n  \n\n  \n\n\n    const sendMessageHandler = (newMessage) => {\n\n        // We check if this is the user turn to give an input.\n        // If we already have a name, we expect math expression. Otherwise, we expect a name and add the correct messages.\n        if(!isBot){   \n            setIsBot(false)\n\n            if(!name){\n                setName(newMessage)\n                throttleMessages([\n                            { message: newMessage, isUserInput: true },\n                            ...BOT_STEPS.NICE_TO_MEET(newMessage), \n                            ...BOT_STEPS.DESCRIBE_PROCESS()])\n            }\n            else {\n                throttleMessages([\n                            { message: newMessage, isUserInput: true },\n                            { message: calculateMathExpression(newMessage) }, \n                            ...BOT_STEPS.BOT_FEEDBACK()])\n            }\n\n           return\n        }\n        // Add user messages to the list even if it is not the user turn\n        throttleMessages([ { message: newMessage, isUserInput: true }])\n        \n    }\n\n  return (\n    <div className=\"chat-container\">\n        <ChatHeader/>\n        <ChatContent messages={messages}/>\n        <ChatFooter onSend={sendMessageHandler}/>\n    </div>\n  );\n}\n\nexport default Chat;\n"]},"metadata":{},"sourceType":"module"}